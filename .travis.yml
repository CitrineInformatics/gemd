language: python
dist: bionic
python:
- '3.7'
- '3.8'
- '3.9'
- '3.10'
env:
- PINT_VERSION=0.18
- PINT_VERSION=0.20
jobs:
  exclude:
    - python: 3.7
      env: PINT_VERSION=0.20
install:
- pip install -U -r requirements.txt
- pip install Pint==$PINT_VERSION
- pip install -U -r test_requirements.txt
- pip install --no-deps -e .
script:
- flake8 gemd
- pytest --cov=gemd --cov-report term-missing:skip-covered --cov-config=tox.ini --no-cov-on-fail --cov-fail-under=100 gemd
- cd docs; make html; cd ..;
- touch ./docs/_build/html/.nojekyll
- if [ "$TRAVIS_PULL_REQUEST" != "false" ] && [ "$TRAVIS_BRANCH" == "main" ]; then bash ./scripts/validate-version-bump.sh; fi
deploy:
  - provider: pages
    skip_cleanup: true
    github_token: "$GH_SECRET_TOKEN"
    keep_history: true
    local_dir: "./docs/_build/html/"
    on:
      tags: true
      python: '3.7' # only need this to run once
      env: PINT_VERSION=0.18
  - provider: pypi
    user: "CitrineInformatics"
    password: "$PYPI_PASSWORD"
    distributions: "sdist bdist_wheel"
    skip_existing: true
    on:
      tags: true
